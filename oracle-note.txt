# Oracle ICS - Backend JWT Auth Setup Notes

## ÄÃ£ cÃ i Ä‘áº·t cÃ¡c package:
- @nestjs/jwt, @nestjs/passport, passport, passport-jwt, passport-local, bcryptjs, cookie-parser, class-validator, class-transformer
- CÃ¡c package type cho dev: @types/passport-jwt, @types/passport-local, @types/bcryptjs, @types/cookie-parser

## ÄÃ£ thÃªm cÃ¡c file sau:

### src/entities/user.entity.ts
- Äá»‹nh nghÄ©a entity User cho báº£ng users trong database.

### src/auth/dto/auth.dto.ts
- Äá»‹nh nghÄ©a DTO cho login vÃ  register (LoginDto, RegisterDto).

### src/auth/auth.service.ts
- Xá»­ lÃ½ logic Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, xÃ¡c thá»±c user, mÃ£ hÃ³a máº­t kháº©u, sinh JWT.

### src/auth/jwt.strategy.ts
- Passport strategy cho xÃ¡c thá»±c JWT, láº¥y token tá»« header hoáº·c cookie.

### src/auth/jwt-auth.guard.ts
- Guard báº£o vá»‡ cÃ¡c route cáº§n xÃ¡c thá»±c JWT.

### src/auth/auth.controller.ts
- Äá»‹nh nghÄ©a cÃ¡c endpoint: /auth/register, /auth/login, /auth/logout, /auth/profile. ÄÄƒng nháº­p/Ä‘Äƒng kÃ½ tráº£ vá» JWT qua cookie.

### src/auth/auth.module.ts
- Module tá»•ng há»£p cÃ¡c thÃ nh pháº§n authentication.

### src/migrations/1694339500000-CreateUsersTable.ts
- Migration táº¡o báº£ng users.

## ÄÃ£ cáº­p nháº­t:
- main.ts: ThÃªm cookie-parser, validation pipe, enable CORS cho frontend.
- app.module.ts: Import AuthModule, cáº¥u hÃ¬nh TypeORM cho autoLoadEntities.

## TÃ¡c dá»¥ng:
- Cho phÃ©p Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, xÃ¡c thá»±c JWT, lÆ°u token vÃ o cookie HTTP-only, báº£o vá»‡ cÃ¡c route cáº§n Ä‘Äƒng nháº­p.
- ÄÃ£ chuáº©n bá»‹ migration táº¡o báº£ng users Ä‘á»ƒ lÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng.

---

# Oracle ICS - Frontend Authentication Setup Notes

## ÄÃ£ cÃ i Ä‘áº·t cÃ¡c package frontend:
- zustand: State management cho auth
- js-cookie, @types/js-cookie: Quáº£n lÃ½ cookies
- axios: HTTP client cho API calls
- react-hook-form, @hookform/resolvers, zod: Form validation
- @tanstack/react-query: Data fetching (Ä‘Ã£ cÃ i nhÆ°ng chÆ°a dÃ¹ng)

## ÄÃ£ táº¡o cÃ¡c file frontend:

### hooks/use-auth-store.ts
- Zustand store quáº£n lÃ½ state authentication
- State: user, token, isLoading, error, isAuthenticated
- Actions: login, logout, setUser, setToken, initAuth
- Persist user info trong localStorage, token trong cookies

### lib/auth-api.ts
- Service gá»i API backend cho authentication
- Axios instance vá»›i interceptors tá»± Ä‘á»™ng attach token
- Functions: login, register, getCurrentUser, logout, googleLogin, forgotPassword, resetPassword
- Auto redirect khi token háº¿t háº¡n (401)

### app/login/page.tsx
- Trang Ä‘Äƒng nháº­p vá»›i form validation (react-hook-form + zod)
- UI: email, password, show/hide password, Google login button
- Link Ä‘áº¿n trang Ä‘Äƒng kÃ½ vÃ  quÃªn máº­t kháº©u
- Auto redirect vá» returnUrl sau login thÃ nh cÃ´ng

### app/register/page.tsx
- Trang Ä‘Äƒng kÃ½ vá»›i form validation 
- UI: firstName, lastName, email, password, confirmPassword
- Validation: confirm password pháº£i khá»›p
- Google signup button, link Ä‘áº¿n trang Ä‘Äƒng nháº­p
- Auto login sau Ä‘Äƒng kÃ½ thÃ nh cÃ´ng

### app/profile/page.tsx
- Trang thÃ´ng tin cÃ¡ nhÃ¢n (protected route)
- Hiá»ƒn thá»‹: avatar, user info, created/updated date
- Form chá»‰nh sá»­a thÃ´ng tin vá»›i validation
- Sá»­ dá»¥ng withAuth HOC Ä‘á»ƒ báº£o vá»‡

### components/header.tsx
- Cáº­p nháº­t header vá»›i auth logic
- Hiá»ƒn thá»‹ SimpleDropdown khi Ä‘Ã£ Ä‘Äƒng nháº­p
- Buttons Ä‘Äƒng nháº­p/Ä‘Äƒng kÃ½ khi chÆ°a authenticate
- Mobile menu support

### components/ui/simple-dropdown.tsx
- Custom dropdown component thay tháº¿ Radix UI
- Click to toggle, click outside to close
- Menu items: ThÃ´ng tin cÃ¡ nhÃ¢n, CÃ i Ä‘áº·t, ÄÄƒng xuáº¥t
- Dark mode support, responsive

### components/auth/with-auth.tsx
- HOC (Higher-Order Component) báº£o vá»‡ components
- Options: requireAuth, redirectTo, fallback
- Hook useAuth cho auth logic
- Functions: hasPermission, ProtectedContent component

### components/providers/auth-provider.tsx
- Global auth provider wrap toÃ n bá»™ app
- Auto initialize auth khi app khá»Ÿi Ä‘á»™ng
- Fetch user data náº¿u cÃ³ token nhÆ°ng chÆ°a cÃ³ user info

### middleware.ts
- Next.js middleware báº£o vá»‡ routes
- Protected routes: /profile, /dashboard, /settings, /admin
- Guest-only routes: /login, /register
- Auto redirect vá»›i returnUrl

### components/hero-section.tsx
- Cáº­p nháº­t CTA button dá»±a trÃªn auth status
- "ÄÄƒng nháº­p ngay" khi chÆ°a auth
- "Quáº£n lÃ½ tÃ i khoáº£n" khi Ä‘Ã£ auth

### app/layout.tsx
- Wrap app vá»›i AuthProvider
- Cáº­p nháº­t metadata cho Oracle Cloud Vietnam

### .env.local
- NEXT_PUBLIC_API_BASE_URL=http://localhost:3001

## TÃ­nh nÄƒng Ä‘Ã£ hoÃ n thÃ nh:

### ğŸ” Authentication Flow:
- ÄÄƒng kÃ½ tÃ i khoáº£n má»›i
- ÄÄƒng nháº­p vá»›i email/password  
- Tá»± Ä‘á»™ng lÆ°u JWT token vÃ o HTTP-only cookies
- Auto fetch user info khi cÃ³ token
- ÄÄƒng xuáº¥t vÃ  clear token/user data

### ğŸ›¡ï¸ Route Protection:
- Middleware báº£o vá»‡ protected routes
- withAuth HOC báº£o vá»‡ components
- Auto redirect Ä‘áº¿n login vá»›i returnUrl
- Guest-only routes (login/register) redirect khi Ä‘Ã£ auth

### ğŸ¨ UI/UX:
- Form validation vá»›i error messages
- Loading states during API calls
- Success/error alerts
- Responsive design cho mobile/desktop
- Dark mode support

### ğŸ”’ Security:
- JWT token trong HTTP-only cookies
- Auto logout khi token háº¿t háº¡n
- CSRF protection vá»›i SameSite cookies
- Input validation vÃ  sanitization

### ğŸ“± Features:
- Profile page vá»›i edit form
- Header dropdown menu
- Mobile menu support
- Hero section CTA tÃ¹y theo auth status

## API Endpoints sá»­ dá»¥ng:
- POST /auth/login: ÄÄƒng nháº­p
- POST /auth/register: ÄÄƒng kÃ½
- GET /auth/profile: Láº¥y thÃ´ng tin user
- POST /auth/logout: ÄÄƒng xuáº¥t
- POST /auth/google: Google OAuth (planned)

## CÃ¡ch test:
1. Cháº¡y backend: cd oracle-ics-backend && npm run start:dev
2. Cháº¡y frontend: cd oracle-ics-frontend && npm run dev
3. Truy cáº­p http://localhost:3001
4. Test Ä‘Äƒng kÃ½ â†’ Ä‘Äƒng nháº­p â†’ profile â†’ Ä‘Äƒng xuáº¥t

## Tráº¡ng thÃ¡i hiá»‡n táº¡i:
- âœ… Frontend auth system hoÃ n chá»‰nh
- âœ… Dropdown menu header hoáº¡t Ä‘á»™ng
- âœ… Protected routes working
- âœ… Form validation working
- ğŸ”„ Cáº§n test vá»›i backend tháº­t
- ğŸ“‹ TODO: Google OAuth integration
